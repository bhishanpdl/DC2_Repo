DC2 Notebooks
=============

This directory contains tutorial and demonstration notebooks convering how to access and use the DC2 datasets.
See the index table below for links to the notebook code, and an auto-rendered view of the notebook with outputs.
Notes on how to contribute more notebooks, and how the rendering is made, are at the bottom of the page.

.. list-table::
   :widths: 10 20 10 10
   :header-rows: 1

   * - Notebook
     - Short description
     - Links
     - Owner


   * - DC2 Coadd Run1.1p GCR Tutorial Part I: GCR access
     - Use the GCR for simple access to the coadd catalogs
     - `ipynb <DC2%20Coadd%20Run1.1p%20GCR%20tutorial%20--%20Part%20I%3A%20GCR%20Access.ipynb>`_, `rendered <https://nbviewer.jupyter.org/github/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/DC2_Coadd_Run1.1p_GCR_tutorial_--_Part_I:_GCR_Access.nbconvert.ipynb>`_

       .. image:: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/DC2_Coadd_Run1.1p_GCR_tutorial_--_Part_I:_GCR_Access.svg
          :target: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/DC2_Coadd_Run1.1p_GCR_tutorial_--_Part_I:_GCR_Access.log

     - `Francois Lanusse <https://github.com/LSSTDESC/DC2_Repo/issues/new?body=@EiffL>`_, `Javier Sanchez <https://github.com/LSSTDESC/DC2_Repo/issues/new?body=@fjaviersanchez>`_


   * - DC2 Coadd Run1.1p GCR Tutorial Part II: Lensing Cuts
     - Use the GCR to build a lensing sample similar to the HSC Y1 shape catalog
     - `ipynb <DC2%20Coadd%20Run1.1p%20GCR%20tutorial%20--%20Part%20II%3A%20Lensing%20Cuts.ipynb>`_, `rendered <https://nbviewer.jupyter.org/github/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/DC2_Coadd_Run1.1p_GCR_tutorial_--_Part_II:_Lensing_Cuts.nbconvert.ipynb>`_

       .. image:: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/DC2_Coadd_Run1.1p_GCR_tutorial_--_Part_II:_Lensing_Cuts.svg
          :target: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/DC2_Coadd_Run1.1p_GCR_tutorial_--_Part_II:_Lensing_Cuts.log

     - `Francois Lanusse <https://github.com/LSSTDESC/DC2_Repo/issues/new?body=@EiffL>`_, `Javier Sanchez <https://github.com/LSSTDESC/DC2_Repo/issues/new?body=@fjaviersanchez>`_


   * - DC2 Coadd Run1.1p GCR Tutorial Part III: Guided Challenges
     - Use the GCR to solve some typical data analysis problems
     - `ipynb <DC2%20Coadd%20Run1.1p%20GCR%20tutorial%20--%20Part%20III%3A%20Guided%20Challenges.ipynb>`_, `rendered <https://nbviewer.jupyter.org/github/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/DC2_Coadd_Run1.1p_GCR_tutorial_--_Part_III:_Guided_Challenges.nbconvert.ipynb>`_

       .. image:: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/DC2_Coadd_Run1.1p_GCR_tutorial_--_Part_III:_Guided_Challenges.svg
          :target: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/DC2_Coadd_Run1.1p_GCR_tutorial_--_Part_III:_Guided_Challenges.log

     - `Francois Lanusse <https://github.com/LSSTDESC/DC2_Repo/issues/new?body=@EiffL>`_, `Javier Sanchez <https://github.com/LSSTDESC/DC2_Repo/issues/new?body=@fjaviersanchez>`_


   * - DC2 Coadd Run1.1p direct access, color-color stellar locus
     - Directly access the Run 1.1p coadd catalogs and explore the stellar locus
     - `ipynb <DC2%20Coadd%20Run1.1p%20direct%20access%20--%20color-color%20stellar%20locus.ipynb>`_,
       `rendered <https://nbviewer.jupyter.org/github/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/DC2_Coadd_Run1.1p_direct_access_--_color-color_stellar_locus.nbconvert.ipynb>`_

       .. image:: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/DC2_Coadd_Run1.1p_direct_access_--_color-color_stellar_locus.svg
          :target: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/DC2_Coadd_Run1.1p_direct_access_--_color-color_stellar_locus.log

     - `Michael Wood-Vasey <https://github.com/LSSTDESC/DC2_Repo/issues/new?body=@wmwv>`_


   * - DC2 Coadd Run1.1p Butler Access HSC selection
     - Use the Butler to apply the HSC object selection cuts
     - `ipynb <DC2_Coadd_Run1.1p_Butler_Access_HSC_selection.ipynb>`_,
       `rendered <https://nbviewer.jupyter.org/github/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/DC2_Coadd_Run1.1p_Butler_Access_HSC_selection.nbconvert.ipynb>`_

       .. image:: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/DC2_Coadd_Run1.1p_Butler_Access_HSC_selection.svg
          :target: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/DC2_Coadd_Run1.1p_Butler_Access_HSC_selection.log

     - `Jim Chiang <https://github.com/LSSTDESC/DC2_Repo/issues/new?body=@jchiang87>`_


   * - DC2 Postage Stamps
     - Make some small cutout images and visualize them
     - `ipynb <DC2%20Postage%20Stamps.ipynb>`_,
       `rendered <https://nbviewer.jupyter.org/github/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/DC2_Postage_Stamps.nbconvert.ipynb>`_

       .. image:: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/DC2_Postage_Stamps.svg
          :target: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/DC2_Postage_Stamps.log

     - `Michael Wood-Vasey <https://github.com/LSSTDESC/DC2_Repo/issues/new?body=@wmwv>`_
     
     
   * - Plotting Run1.1p skymap
     - Use the data butler to obtain information on the skyMap used in the coadd analyses performed by the DRP pipeline.  
     - `ipynb <Plotting_the_Run1.1p_skymap.ipynb>`_,
       `rendered <https://nbviewer.jupyter.org/github/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/Plotting_the_Run1.1p_skymap.nbconvert.ipynb>`_

       .. image:: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/Plotting_the_Run1.1p_skymap.svg
          :target: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/Plotting_the_Run1.1p_skymap.log

     - `Jim Chiang <https://github.com/LSSTDESC/DC2_Repo/issues/new?body=@jchiang87>`_


   * - LSST Stack matching code
     - Spatial matching of objects using the DM Stack
     - `ipynb <LSST_Stack_matching_code.ipynb>`_,
       `rendered <https://nbviewer.jupyter.org/github/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/LSST_Stack_matching_code.nbconvert.ipynb>`_

       .. image:: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/LSST_Stack_matching_code.svg
          :target: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/LSST_Stack_matching_code.log

     - `Jim Chiang <https://github.com/LSSTDESC/DC2_Repo/issues/new?body=@jchiang87>`_


   * - FoF Catalog Matching
     - Using the Friends of Friends algorithm to match two catalogs
     - `ipynb <FoFCatalogMatching%20Histogram.ipynb>`_,
       `rendered <https://nbviewer.jupyter.org/github/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/FoFCatalogMatching_Histogram.nbconvert.ipynb>`_

       .. image:: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/FoFCatalogMatching_Histogram.svg
          :target: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/FoFCatalogMatching_Histogram.log

     - `Yao-Yuan Mao <https://github.com/LSSTDESC/DC2_Repo/issues/new?body=@yymao>`_


   * - DC2 Truth Catalog
     - Example of accessing DC2 truth catalog with GCR
     - `ipynb <DC2_truth_example.ipynb>`_,
       `rendered <https://nbviewer.jupyter.org/github/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/DC2_truth_example.nbconvert.ipynb>`_

       .. image:: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/DC2_truth_example.svg
          :target: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/DC2_truth_example.log

     - `Scott Daniel <https://github.com/LSSTDESC/DC2_Repo/issues/new?body=@danielsf>`_


   * - protoDC2 redshift distributions
     - Extract, plot and explore the differential number counts of galaxies 
     - `ipynb <N_vs_z_distributions.ipynb>`_,
       `rendered <https://nbviewer.jupyter.org/github/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/N_vs_z_distributions.nbconvert.ipynb>`_

       .. image:: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/N_vs_z_distributions.svg
          :target: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/N_vs_z_distributions.log

     - `Eve Kovacs <https://github.com/LSSTDESC/DC2_Repo/issues/new?body=@evevkovacs>`_


   * - protoDC2 Halo Occupation Distribution
     - Compute and plot the HOD for the protoDC2 extragalactic catalog 
     - `ipynb <protoDC2%20HOD.ipynb>`_,
       `rendered <https://nbviewer.jupyter.org/github/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/protoDC2_HOD.nbconvert.ipynb>`_

       .. image:: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/protoDC2_HOD.svg
          :target: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/protoDC2_HOD.log

     - `Yao-Yuan Mao <https://github.com/LSSTDESC/DC2_Repo/issues/new?body=@yymao>`_


   * - protoDC2 halo mass relations
     - Compute and plot the relations between halo mass and other quantities in the protoDC2 extragalactic catalog 
     - `ipynb <protoDC2%20mass%20relations.ipynb>`_,
       `rendered <https://nbviewer.jupyter.org/github/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/protoDC2_mass_relations.nbconvert.ipynb>`_

       .. image:: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/protoDC2_mass_relations.svg
          :target: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/protoDC2_mass_relations.log

     - `Yao-Yuan Mao <https://github.com/LSSTDESC/DC2_Repo/issues/new?body=@yymao>`_


   * - protoDC2 cluster colors
     - Access the protoDC2 extragalactic catalog with the GCR, and explore colors in galaxy clusters
     - `ipynb <ProtoDC2_Cluster_Colors.ipynb>`_,
       `rendered <https://nbviewer.jupyter.org/github/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/ProtoDC2_Cluster_Colors.nbconvert.ipynb>`_

       .. image:: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/ProtoDC2_Cluster_Colors.svg
          :target: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/ProtoDC2_Cluster_Colors.log

     - `Dan Korytov <https://github.com/LSSTDESC/DC2_Repo/issues/new?body=@dkorytov>`_


   * - protoDC2 cluster members
     - Extract cluster member galaxies from the protoDC2 extragalactic catalog and plot them on the sky
     - `ipynb <ProtoDC2_Cluster_Member_Cutout.ipynb>`_,
       `rendered <https://nbviewer.jupyter.org/github/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/ProtoDC2_Cluster_Member_Cutout.nbconvert.ipynb>`_

       .. image:: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/ProtoDC2_Cluster_Member_Cutout.svg
          :target: https://github.com/LSSTDESC/DC2_Repo/blob/rendered/Notebooks/log/ProtoDC2_Cluster_Member_Cutout.log

     - `Dan Korytov <https://github.com/LSSTDESC/DC2_Repo/issues/new?body=@dkorytov>`_


----

Notes for Contributors
----------------------
Both tutorial and demo notebooks are hugely useful resources - pull requests are most welcome!

* Before you commit a notebook, please make sure that a) it runs to completion and b) the outputs are cleared (to avoid both repo bloat and conflicts on every run due to semantically equivalent but bitwise-distinct output blobs).

* Please update the index table above, carefully copying and adapting the URLs, and making sure that all the lines in the table are correctly aligned (or else the table will not display). *Pro-tip: use the "preview changes" tab in the online GitHub editor to check that the table is correct before committing.*  Adding your notebook to the table will trigger the automatic testing of it once your PR is merged (see the "Semi-continuous Integration" section below).

* The "owner" of a notebook (that's you, as its contributor!) is responsible for accepting proposed modifications to it (by collaboration), and making sure that it does not go stale (by fixing issues posted about it).

* Every tutorial notebook needs an owner/last verified header, a statement of its goals (learning objectives) in the first markdown cell, and enough explanatory markdown (with links to docs, papers etc) to make the notebook make sense.

Semi-continuous Integration
---------------------------
All the notebooks listed in the table above (and on the master branch) are run every 6 hours on Cori using the [`beavis-ci` script](beavis-ci.sh), which then pushes them to an orphan "rendered" branch so that the outputs can be viewed. (At present, it seems that DC2_Repo admin permissions are needed to execute this push, but in principle anyone could run this script.)

    If the link to a rendered notebook yields a 404 error, please check the corresponding log file (by clicking on the "build:failing" badge) and issue the notebook's owner. If it looks like something has gone wron with the cron job (like, none of the notebook builds are passing, or the logs indicate some problem with the run environment, `issue @drphilmarshall <https://github.com/LSSTDESC/DC2_Repo/issues/new?body=@drphilmarshall>`_.
